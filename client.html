<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>Client Details | Smart Learning</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="icon" type="image/png" href="images/logo.png">

<style>
.client{
  display:flex;
  justify-content:center;
  align-items:center;
  margin-top:60px;
}
.client-box{
  width:900px;
  display:flex;
  gap:40px;
}
.client-form, .summary{
  flex:1;
  background:white;
  padding:25px;
  border-radius:10px;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
}
.client-form input{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
.confirm-btn{
  width:100%;
  padding:14px;
  background:#f28c28;
  border:none;
  color:white;
  font-size:16px;
  border-radius:6px;
  cursor:pointer;
  margin-top:15px;
}
.confirm-btn:hover{
  background:#e07813;
}
.navbar{
  background:#2d4f63;
  color:white;
  padding:15px;
}
.navbar a{
  color:white;
  margin-left:20px;
  text-decoration:none;
}
</style>

</head>
<body>

<!-- NAVBAR -->

<nav class="navbar">
<div class="logo">Smart Learning</div>
<a href="index.html">Home</a>
<a href="services.html">Services</a>
</nav>

<!-- CLIENT PAGE -->

<section class="client">
<div class="client-box">

<!-- FORM -->

<div class="client-form">
<h3>Your Details</h3>

<input id="name" type="text" placeholder="Full Name">
<input id="email" type="email" placeholder="Email">
<input id="phone" type="tel" placeholder="Phone">

<button type="button" class="confirm-btn" onclick="confirmBooking()">
  Confirm Booking (First click may take 30s ⏳)
</button>

</div>

<!-- SUMMARY -->

<div class="summary">
<h3>Booking Summary</h3>

<p><strong>Service:</strong> <span id="service-name"></span></p>
<p><strong>Date:</strong> <span id="booking-date"></span></p>
<p><strong>Time:</strong> <span id="booking-time"></span></p>
<p><strong>Duration:</strong> 1 Hour</p>
<p><strong>Price:</strong> ₹100.00</p>

</div>

</div>
</section>

<script>

// Show selected booking
window.onload = function(){

const service = localStorage.getItem("selectedService");
const date = localStorage.getItem("selectedDate");
const time = localStorage.getItem("selectedTime");

if(!service || !date || !time){
alert("Please select service first");
window.location.href="services.html";
return;
}

document.getElementById("service-name").innerText = service;
document.getElementById("booking-date").innerText = date;
document.getElementById("booking-time").innerText = time;
};
</script>


// BOOKING FUNCTION
<script>
async function confirmBooking() {

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const phone = document.getElementById("phone").value.trim();

  if (!name || !email || !phone) {
    alert("Please fill all details");
    return;
  }

  const service = localStorage.getItem("selectedService");
  const date = localStorage.getItem("selectedDate");
  const time = localStorage.getItem("selectedTime");

  if (!service || !date || !time) {
    alert("Please select service, date and time first");
    window.location.href = "services.html";
    return;
  }

  const data = { service, date, time, name, email, phone };

  try {

    const response = await fetch("/book", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    // IMPORTANT
    if (!result.success) {
      alert("Booking failed: " + result.message);
      return;
    }

    // ===== ONLY IF SAVED SUCCESSFULLY =====
    alert("Booking Confirmed ✅");

    const message =
`New Booking - Smart Learning

Service: ${service}
Date: ${date}
Time: ${time}

Student Name: ${name}
Phone: ${phone}
Email: ${email}`;

    const whatsappNumber = "919342530010";
    const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

    window.open(whatsappURL, "_blank");
    window.location.href = "mybookings.html";

  } catch (err) {
    console.error(err);
    alert("Server not responding. Please try again in 20 seconds.");
  }
}
</script>



</body>
</html>
